var e=require("@chriscdn/promise-semaphore");module.exports=function(r,n,t,o){var i;void 0===t&&(t=function(){}),void 0===o&&(o={});var u=0,c=r.length,l=null!=(i=o.rateLimit)?i:0,s=l>0?new e.Semaphore(l):null,a=r.map(function(e,r,o){return new Promise(function(i,l){try{return setTimeout(function(){try{var a=function(a,h){try{var m=function(l,a){try{var h=Promise.resolve(null==s?void 0:s.acquire()).then(function(){return Promise.resolve(n(e,r,o)).then(function(n){i(n),t({progress:u++,total:c,percent:Math.floor(100*u/c),item:e,index:r,result:n})})})}catch(e){return a(e)}return h&&h.then?h.then(void 0,a):h}(0,function(e){l(e)})}catch(e){return h(!0,e)}return m&&m.then?m.then(h.bind(null,!1),h.bind(null,!0)):h(!1,m)}(0,function(e,r){if(null==s||s.release(),e)throw r;return r});return Promise.resolve(a&&a.then?a.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},0),Promise.resolve()}catch(e){return Promise.reject(e)}})});return Promise.all(a)};
//# sourceMappingURL=async-each.cjs.map
